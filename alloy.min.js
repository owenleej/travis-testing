/**
 * Copyright 2019 Adobe. All rights reserved.
 * This file is licensed to you under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License. You may obtain a copy
 * of the License at http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software distributed under
 * the License is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS
 * OF ANY KIND, either express or implied. See the License for the specific language
 * governing permissions and limitations under the License.
 */

!function(e){"function"==typeof define&&define.amd?define(e):e()}(function(){"use strict";var e=Object.getOwnPropertySymbols,n=Object.prototype.hasOwnProperty,t=Object.prototype.propertyIsEnumerable;var r=function(){try{if(!Object.assign)return!1;var e=new String("abc");if(e[5]="de","5"===Object.getOwnPropertyNames(e)[0])return!1;for(var n={},t=0;t<10;t++)n["_"+String.fromCharCode(t)]=t;if("0123456789"!==Object.getOwnPropertyNames(n).map(function(e){return n[e]}).join(""))return!1;var r={};return"abcdefghijklmnopqrst".split("").forEach(function(e){r[e]=e}),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},r)).join("")}catch(e){return!1}}()?Object.assign:function(r,o){for(var i,a,c=function(e){if(null==e)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(e)}(r),u=1;u<arguments.length;u++){for(var f in i=Object(arguments[u]))n.call(i,f)&&(c[f]=i[f]);if(e){a=e(i);for(var s=0;s<a.length;s++)t.call(i,a[s])&&(c[a[s]]=i[a[s]])}}return c},o=function(e){return JSON.parse(JSON.stringify(e))};function i(e,n){return e(n={exports:{}},n.exports),n.exports}var a=i(function(e,n){var t;t=function(){function e(){for(var e=0,n={};e<arguments.length;e++){var t=arguments[e];for(var r in t)n[r]=t[r]}return n}return function n(t){function r(n,o,i){var a;if("undefined"!=typeof document){if(arguments.length>1){if("number"==typeof(i=e({path:"/"},r.defaults,i)).expires){var c=new Date;c.setMilliseconds(c.getMilliseconds()+864e5*i.expires),i.expires=c}i.expires=i.expires?i.expires.toUTCString():"";try{a=JSON.stringify(o),/^[\{\[]/.test(a)&&(o=a)}catch(e){}o=t.write?t.write(o,n):encodeURIComponent(String(o)).replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g,decodeURIComponent),n=(n=(n=encodeURIComponent(String(n))).replace(/%(23|24|26|2B|5E|60|7C)/g,decodeURIComponent)).replace(/[\(\)]/g,escape);var u="";for(var f in i)i[f]&&(u+="; "+f,!0!==i[f]&&(u+="="+i[f]));return document.cookie=n+"="+o+u}n||(a={});for(var s=document.cookie?document.cookie.split("; "):[],l=/(%[0-9A-Z]{2})+/g,d=0;d<s.length;d++){var p=s[d].split("="),g=p.slice(1).join("=");'"'===g.charAt(0)&&(g=g.slice(1,-1));try{var v=p[0].replace(l,decodeURIComponent);if(g=t.read?t.read(g,v):t(g,v)||g.replace(l,decodeURIComponent),this.json)try{g=JSON.parse(g)}catch(e){}if(n===v){a=g;break}n||(a[v]=g)}catch(e){}}return a}}return r.set=r,r.get=function(e){return r.call(r,e)},r.getJSON=function(){return r.apply({json:!0},[].slice.call(arguments))},r.defaults={},r.remove=function(n,t){r(n,"",e(t,{expires:-1}))},r.withConverter=n,r}(function(){})},e.exports=t()}),c={get:a.get,set:a.set,remove:a.remove},u=function(e,n){return function(t){e[n]=e[n]||{},r(e[n],t)}},f=function(e,n){for(var t=0;t<e.length;t+=1){var r=e[t];if(n(r,t,e))return r}};function s(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function l(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{},r=Object.keys(t);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(t).filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.forEach(function(n){s(e,n,t[n])})}return e}function d(e,n){return function(e){if(Array.isArray(e))return e}(e)||function(e,n){var t=[],r=!0,o=!1,i=void 0;try{for(var a,c=e[Symbol.iterator]();!(r=(a=c.next()).done)&&(t.push(a.value),!n||t.length!==n);r=!0);}catch(e){o=!0,i=e}finally{try{r||null==c.return||c.return()}finally{if(o)throw i}}return t}(e,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function p(e){return function(e){if(Array.isArray(e)){for(var n=0,t=new Array(e.length);n<e.length;n++)t[n]=e[n];return t}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var g=function(e){return"function"==typeof e},v=function(e){return Array.isArray(e)&&e.length>0};function m(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:document;return[].slice.call(n.querySelectorAll(e))}var y={childList:!0,subtree:!0},h=5e3,w=function(e){return new Error("Could not find: "+e)},b=function(e){return new Promise(e)},O=function(e){return g(e.MutationObserver)},E=function(e,n,t,r,o){return b(function(i,a){var c=new e.MutationObserver(function(){var e=o(t);v(e)&&(c.disconnect(),i(e))});setTimeout(function(){c.disconnect(),a(w(t))},r),c.observe(n,y)})},C=function(e){return"visible"===e.visibilityState},S=function(e,n,t,r){return b(function(o,i){!function t(){var i=r(n);v(i)?o(i):e.requestAnimationFrame(t)}(),setTimeout(function(){i(w(n))},t)})},j=function(e,n,t){return b(function(r,o){!function n(){var o=t(e);v(o)?r(o):setTimeout(n,100)}(),setTimeout(function(){o(w(e))},n)})};function x(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:h,t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:m,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:window,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:document,i=t(e);return v(i)?Promise.resolve(i):O(r)?E(r,o,e,n,t):C(o)?S(r,e,n,t):j(e,n,t)}function I(e,n){return e.appendChild(n)}function R(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r=(arguments.length>3&&void 0!==arguments[3]?arguments[3]:document).createElement(e);return Object.keys(n).forEach(function(e){var t=n[e];"function"==typeof t?r[e]=t:r.setAttribute(e,t)}),t.forEach(function(e){return I(r,e)}),r}function T(e){var n=e.parentNode;return n?n.removeChild(e):null}var k=function(e){var n=e.currentDocument,t=void 0===n?document:n,r=e.src;return new Promise(function(e,n){R("img",{onload:e,onerror:n,onabort:n,src:r},[],t)})},P=k,D={name:"Adobe Destinationing iFrame",class:"adobe-iframe",style:"display: none; width: 0; height: 0;"},A=function(e){return function(n){return n.succeeded===e}},B=function(e){return e.dest},M=function(e){var n,t=e.logger,r=e.destinations,o=function(e){var t=e.src;return(n||(n=x("BODY").then(function(e){return I(d(e,1)[0],R("IFRAME",D))})),n).then(function(e){var n=e.contentWindow.document;return k({src:t,currentDocument:n})})};return Promise.all(r.map(function(e){return(e.hideReferrer?o({src:e.url}):P({src:e.url})).then(function(){return t.log("Destination succeeded:",e.url),{succeeded:!0,dest:e}}).catch(function(){return t.log("Destination failed:",e.url),{succeeded:!1,dest:e}})})).then(function(e){return n&&n.then(function(e){return T(e)}),{succeeded:e.filter(A(!0)).map(B),failed:e.filter(A(!1)).map(B)}})},U=function(e,n){return e.slice(-n)},N=function(e){return"string"==typeof e},V="com.adobe.alloy.",q=V+"getTld",J="";function L(e,n){if(J)return J;for(var t=e.location.hostname.toLowerCase().split("."),r=1;r<t.length-1&&!n.get(q);)J=U(t,r+=1).join("."),n.set(q,q,{domain:J});return n.remove(q,{domain:J}),J}function _(e,n){return Object.prototype.hasOwnProperty.call(e,n)}var F=function(e,n,t,r){n=n||"&",t=t||"=";var o={};if("string"!=typeof e||0===e.length)return o;var i=/\+/g;e=e.split(n);var a=1e3;r&&"number"==typeof r.maxKeys&&(a=r.maxKeys);var c=e.length;a>0&&c>a&&(c=a);for(var u=0;u<c;++u){var f,s,l,d,p=e[u].replace(i,"%20"),g=p.indexOf(t);g>=0?(f=p.substr(0,g),s=p.substr(g+1)):(f=p,s=""),l=decodeURIComponent(f),d=decodeURIComponent(s),_(o,l)?Array.isArray(o[l])?o[l].push(d):o[l]=[o[l],d]:o[l]=d}return o},z=function(e){switch(typeof e){case"string":return e;case"boolean":return e?"true":"false";case"number":return isFinite(e)?e:"";default:return""}},H=function(e,n,t,r){return n=n||"&",t=t||"=",null===e&&(e=void 0),"object"==typeof e?Object.keys(e).map(function(r){var o=encodeURIComponent(z(r))+t;return Array.isArray(e[r])?e[r].map(function(e){return o+encodeURIComponent(z(e))}).join(n):o+encodeURIComponent(z(e[r]))}).join(n):r?encodeURIComponent(z(r))+t+encodeURIComponent(z(e)):""},K=i(function(e,n){n.decode=n.parse=F,n.encode=n.stringify=H}),W=(K.decode,K.parse,K.encode,K.stringify,function(e){return"string"==typeof e&&(e=e.trim().replace(/^[?#&]/,"")),K.parse(e)}),Q=function(e){return e instanceof Error?e:new Error(e)},X=function(e,n){var t=Q(n);return t.message=e+"\nCaused by: "+t.message,t},Y=function(e,n,t){return{getItem:function(r){try{return e[n].getItem(t+r)}catch(e){return null}},setItem:function(r,o){try{return e[n].setItem(t+r,o),!0}catch(e){return!1}}}},Z=function(e){var n={set:function(e,t){return function(e,n,t){var r,o=[n],i=e;N(n)&&(o=n.split("."));for(var a=0;a<o.length;a+=1)a===o.length-1?(r=i[o[a]],i[o[a]]=t):i[o[a]]||(i[o[a]]={}),i=i[o[a]];return r}(n,e,t)},setAll:function(e){r(n,e)},get:function(e,t){return function(e,n,t){var r=[n],o=e;N(n)&&(r=n.split("."));for(var i=0;i<r.length;i+=1){if(!o||!Object.prototype.hasOwnProperty.call(o,r[i]))return t;o=o[r[i]]}return o}(n,e,t)},keySet:function(){var e=Object.keys(n);return n.forbiddenKeys.forEach(function(n){e.splice(e.indexOf(n),1)}),e},addValidators:function(e){return r(n.validators,e),n.validators},validate:function(){var e=Object.keys(n.validators).reduce(function(e,t){var r=n.get(t),o=n.validators[t];if(null==r&&Object.prototype.hasOwnProperty.call(o,"defaultValue"))n.set(t,o.defaultValue);else if(o.validate){var i=o.validate(n,t,r,o.defaultValue);i&&e.push(i)}return e},[]);if(e.length)throw new Error("Resolve these configuration problems:\n\t - "+e.join("\n\t - ")+"\nFor configuration documentation see: https://launch.gitbook.io/adobe-experience-platform-web-sdk/get-started/getting-started#configuration")},toJSON:function(){var e={};return r(e,n),n.forbiddenKeys.forEach(function(n){delete e[n]}),e},validators:{},forbiddenKeys:[]};return n.forbiddenKeys=Object.keys(n),e&&n.setAll(e),n},$={propertyID:{validate:function(e,n,t){var r="";return null==t&&(r=n+" is a required configuration parameter"),r}},edgeDomain:{validate:function(e,n,t){var r="";return/^[a-z0-9-.]{1,}$/gi.test(t)||(r="Invalid domain for "+n+": "+t+'"'),r},defaultValue:"edgegateway.azurewebsites.net"},shouldStoreCollectedData:{defaultValue:1},device:{defaultValue:"Chrome-Mac"}},G=function(e,n,t,r,o){var i,a=!1,c=function(e){var n=e.enabled;t.logEnabled=n},u=function(e){void 0!==e.log&&c({enabled:e.log});var t,r=W(o.location.search);void 0!==r.alloy_log&&c({enabled:(t=r.alloy_log,N(t)&&("true"===t.toLowerCase()||"1"===t))});var u=Z(e);u.addValidators($);try{i=n(u)}catch(e){throw a=!0,e}};return function(n){var t=n[0],o=n[1],f=n[2],s=f[0],l=f[1];new Promise(function(n){n(function(n,t){var o;if(a)o=function(){return new Promise(function(){})};else if("configure"===n){if(i)throw new Error("The library has already been configured and may only be configured once.");o=u}else if("log"===n)o=c;else{if(!i)throw new Error("The library must be configured first. Please do so by calling "+e+'("configure", {...}).');if(o=i.getCommand(n),!g(o))throw new Error("The "+n+" command does not exist.")}return r.log('Executing "'+n+'" command.',"Options:",t),o(t)}(s,l))}).then(t).catch(function(n){var t=Q(n);t.message="["+e+"] "+t.message,o(t)})}},ee=function(e,n){for(var t=arguments.length,r=new Array(t>2?t-2:0),o=2;o<t;o++)r[o-2]=arguments[o];return Promise.all(e.getLifecycleCallbacks(n).map(function(e){return new Promise(function(n){n(e.apply(void 0,r))})}))},ne=function(e){return function(){for(var n=arguments.length,t=new Array(n),r=0;r<n;r++)t[r]=arguments[r];return Promise.resolve().then(function(){return e.apply(void 0,t)})}},te=function(e,n){return function(){var t;try{t=e.apply(void 0,arguments)}catch(e){throw X(n,e)}return t instanceof Promise&&(t=t.catch(function(e){throw X(n,e)})),t}},re=function(){var e={},n={},t={};return{register:function(r,o){var i=o.commands,a=o.lifecycle;!function(e){var t,r,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=(t=Object.keys(n),r=Object.keys(o),t.filter(function(e){return n=e,-1!==r.indexOf(n);var n}));if(i.length)throw new Error("[ComponentRegistry] Could not register "+e+" because it has existing command(s): "+i.join(","));Object.keys(o).forEach(function(t){var r=o[t];n[t]=te(r,"["+e+"] An error occurred while executing the "+t+" command.")})}(r,i),function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Object.keys(n).forEach(function(r){t[r]=t[r]||[],t[r].push(te(n[r],"["+e+"] An error occurred while executing the "+r+" lifecycle hook."))})}(r,a),e[r]=o},getNamespaceByComponent:function(n){return f(Object.keys(e),function(t){return e[t]===n})},getCommand:function(e){return n[e]},getLifecycleCallbacks:function(e){return t[e]||[]}}},oe=function(e,n,t,r){var o=function(e){var r;try{r=JSON.parse(e)}catch(n){throw new Error("Error parsing server response.\n"+n+"\nResponse body: "+e)}n.log("Received network response:",r);var o=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{requestId:"",handle:[]};return{getPayloadByType:function(n){var t=f(e.handle,function(e){return e.type===n});return t?t.payload:null},toJSON:function(){return e}}}(r);return t.onResponse(o).then(function(){return o})},i=e.edgeDomain,a=e.propertyID;return{newRequest:function(){var e,c=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],f={setPropertyID:function(n){e.propertyID=n},addIdentity:function(n,t){e.identityMap=e.identityMap||{},e.identityMap[n]=e.identityMap[n]||[],e.identityMap[n].push(t)},addEvent:function(n){e.events=e.events||[],e.events.push(n)},mergeMeta:u(e={},"meta"),toJSON:function(){return e}};return{payload:f,send:function(){var e=Promise.resolve().then(function(){return t.onBeforeSend({payload:f,responsePromise:e,isBeacon:c})}).then(function(){var e="https://"+i+"/"+(c?"interact":"collect")+"?propertyID="+a,t=c?"":" (response will be ignored)";return n.log("Sending network request"+t+":",f.toJSON()),r(e,JSON.stringify(f),c)}).then(function(e){var n;return c&&(n=o(e)),n});return e}}}}},ie=function(e){var n,t,r=g(e.fetch)?function(e){return function(n,t){return e(n,{method:"POST",cache:"no-cache",headers:{"Content-Type":"application/json"},referrer:"client",body:t}).then(function(e){if(e.ok){if(204===e.status)return;return e.text()}throw new Error("Bad response code: "+e.status)})}}(e.fetch):(n=e.XMLHttpRequest,function(e,t){return new Promise(function(r,o){var i=new n;i.onreadystatechange=function(){4===i.readyState&&(204===i.status?r():i.status>=200&&i.status<300?r(i.responseText):o(new Error("Invalid response code "+i.status+". Response was "+i.responseText+".")))},i.onloadstart=function(){i.responseType="text"},i.open("POST",e,!0),i.setRequestHeader("Content-Type","application/json"),i.withCredentials=!1,i.onerror=o,i.onabort=o,i.send(t)})}),o=e.navigator&&g(e.navigator.sendBeacon)?(t=e.navigator,function(e,n){return new Promise(function(r,o){var i=new Blob([n],{type:"text/plain; charset=UTF-8"});t.sendBeacon(e,i)?r():o(new Error("Unable to send beacon."))})}):r;return function(e,n,t){return(t?r:o)(e,n)}},ae=function(e,n,t,r){return function(o){var i=re();e.forEach(function(e){var n=e.configValidators;o.addValidators(n)}),o.validate(),e.forEach(function(e){var a,c=e.namespace,u=o.propertyID,f=o.cookieDomain,s=t(o.orgID);try{a=e({logger:n.spawn("["+c+"]"),cookie:r(c,u,f),config:o,storage:s})}catch(e){throw X("["+c+"] An error occurred during component creation.",e)}i.register(c,a)}),n.log("Computed configuration:",o.toJSON());var a=function(e){return{onComponentsRegistered:function(n){return ee(e,"onComponentsRegistered",n)},onBeforeEvent:ne(function(n,t){return ee(e,"onBeforeEvent",n,t)}),onResponse:ne(function(n){return ee(e,"onResponse",n)}),onBeforeUnload:ne(function(){return ee(e,"onBeforeUnload")}),onOptInChanged:ne(function(n){return ee(e,"onOptInChanged",n)}),onBeforeSend:ne(function(n){return ee(e,"onBeforeSend",n)})}}(i),c=function(e,n,t){return oe(e,n,t,ie(window))}(o,n,a);return a.onComponentsRegistered({componentRegistry:i,lifecycle:a,network:c}),i}},ce="adobe_alloy",ue=180,fe=function(e,n){try{return JSON.parse(e)}catch(e){throw new Error("Invalid cookie format in "+n+" cookie")}},se=function(e,n){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";return{get:function(t){var r=ce+"_"+n,o=c.get(r),i=o&&fe(o,r);return i&&i[e]&&i[e][t]},set:function(r,o){var i=ce+"_"+n,a=c.get(i)?fe(c.get(i)):{},u=l({},a,s({},e,l({},a[e],s({},r,o))));c.set(i,u,{expires:ue,domain:t||L(window,c)})},remove:function(r){var o=ce+"_"+n,i=c.get(o),a=i&&fe(i);a&&a[e]&&(delete a[e][r],c.set(o,a,{expires:ue,domain:t||L(window,c)}))}}},le=function(){var e,n;return{lifecycle:{onComponentsRegistered:function(t){e=t.lifecycle,n=t.network}},commands:{event:function(t){var r,i={setCorrelationId:function(e){r.correlationID=e},setTimestamp:function(e){r.timestamp=e},mergeData:u(r={},"data"),mergeMeta:u(r,"meta"),mergeQuery:u(r,"query"),mergeWeb:u(r,"web"),mergeDevice:u(r,"device"),mergeEnvironment:u(r,"environment"),mergePlaceContext:u(r,"placeContext"),expectsResponse:function(){return Boolean(r.query)},toJSON:function(){return r}},a="viewStart"===t.type;return i.mergeData(t.data),i.mergeMeta(t.meta),e.onBeforeEvent(i,a).then(function(){return function(e){var t=e.expectsResponse(),r=n.newRequest(t),i=r.payload,a=r.send;return i.addEvent(e),a().then(function(e){var n={requestBody:o(i)};return e&&(n.responseBody=o(e)),n})}(i)})}}}};le.namespace="DataCollector";var de=function(e){var n,t=e.destinations,o=e.config,i=e.logger;if(o.idSyncsEnabled){var a=((n=c.get(V+"idSyncControl")||"")?n.split("_"):[]).reduce(function(e,n){var t=e,r=d(n.split("-"),2),o=r[0],i=r[1];return t[o]=i,t},{}),u=(new Date).getTime()/36e5;Object.keys(a).forEach(function(e){a[e]<u&&delete a[e]});var f=t.filter(function(e){return"url"===e.type&&void 0===a[e.id]}).map(function(e){return r({id:e.id},e.spec)});f.length&&M({logger:i,destinations:f}).then(function(e){var n,t,r=Math.round((new Date).getTime()/36e5);e.succeeded.forEach(function(e){var n=24*(e.ttl||7);void 0!==e.id&&(a[e.id]=r+n)}),n=a,t=[],Object.keys(n).forEach(function(e){return t.push(e+"-"+n[e])}),c.set(V+"idSyncControl",t.join("_"),{expires:180})})}},pe=function(e,n){e.addIdentity("ECID",{id:n})},ge=function(e){var n,t=e.config,r=e.logger,o=e.cookie,i=function(){return o.get("ECID")},a=i();return{lifecycle:{onBeforeEvent:function(e,n){n&&e.mergeQuery({idSyncs:!0})},onBeforeSend:function(e){var t,r,o=e.payload;return o.mergeMeta({identity:{lastSyncTS:1222,containerId:1}}),a?pe(o,a):n?t=n.promise.then(function(){pe(o,a)}):((r={}).promise=new Promise(function(e,n){r.resolve=e,r.reject=n}),n=r),t},onResponse:function(e){var i=e.getPayloadByType("identity:persist");i&&(a=i.id,o.set("ECID",a),n&&n.resolve());var c=e.getPayloadByType("identity:exchange")||[];de({destinations:c,config:t,logger:r})}},commands:{getEcid:i}}};ge.namespace="Identity",ge.configValidators={idSyncsEnabled:{defaultValue:!0}};var ve=function(e){var n=e.config,t=e.logger;return{lifecycle:{onBeforeEvent:function(e,n){n&&e.mergeQuery({urlDestinations:!0})},onResponse:function(e){!function(e){var n=e.destinations,t=e.config,o=e.logger;if(t.destinationsEnabled){var i=n.filter(function(e){return"url"===e.type}).map(function(e){return r({id:e.id},e.spec)});i.length&&M({logger:o,destinations:i}),n.filter(function(e){return"cookie"===e.type}).map(function(e){return e.spec}).forEach(function(e){c.set(e.name,e.value||"",{domain:e.domain||"",expires:e.ttl?e.ttl:180})})}}({destinations:e.getPayloadByType("activation:push")||[],config:n,logger:t})}},commands:{}}};ve.namespace="Audiences",ve.configValidators={destinationsEnabled:{defaultValue:!0}};var me={},ye=function(e){var n=me[e];n&&T(n)},he=function(e,n){var t=e.selector,r=e.prehidingSelector;!function(e){if(!me[e]){var n=R("style");n.innerText=e+" { visibility: hidden }",I(document.head,n),me[e]=n}}(r),x(t).then(function(e){e.forEach(function(e){n({element:e,prehidingSelector:r})})}).catch(function(){ye(r)})},we=function(e){return{setHtml:function(e){return function(n,t){var r=t.element,o=t.prehidingSelector,i=n.content,a=n.meta;r.innerHTML=i,ye(o),e({meta:{personalization:a}})}}(e),elementExists:he}},be=function(e,n){return n&&!e.negate||!n&&e.negate},Oe=function(e,n,t){var r=!1,o=[],i=function(e,t){var r=n[e];if(!r)throw new Error('Rule component module "'+e+'" not found');return r.apply(void 0,p(t))},a=function(e,n,t,r){return"Failed to execute "+e.moduleType+" for "+n.name+" rule. "+t+" "+(r?"\n "+r:"")},c=function(e,n,r){t.error(a(e,n,r.message,r.stack))},u=function(e,n,r){t.error(a(e,n,r.message,r.stack))},f=function(e,n){t.log("Condition "+e.moduleType+" for rule "+n.name+" not met.")},s=function(e,n){if(e.actions){for(var r,o=0;o<e.actions.length;o+=1){r=e.actions[o];try{i(r.moduleType,[r.settings,n])}catch(n){return void c(r,e,n)}}!function(e){t.log("Rule "+e.name+" fired.")}(e)}};(function(e){var n=[];return e.forEach(function(e){e.events&&e.events.forEach(function(t){n.push({rule:e,event:t})})}),n})(e).forEach(function(e){var n=e.rule,c=e.event;try{i(c.moduleType,[c.settings,function e(t){r?function(e,n){if(e.conditions){for(var t,r=0;r<e.conditions.length;r+=1){t=e.conditions[r];try{var o=i(t.moduleType,[t.settings,n]);if(!be(t,o))return void f(t,e)}catch(n){return void u(t,e,n)}}s(e,n)}}(n,t):o.push(e.bind(null,t))}])}catch(e){t.error(a(c,n,e.message,e.stack))}}),r=!0,o.forEach(function(e){return e()}),o=null},Ee=function(e){var n,t=e.logger;return{lifecycle:{onComponentsRegistered:function(e){var t=e.componentRegistry;n=we(t.getCommand("event"))},onBeforeEvent:function(e,n){n&&e.mergeQuery({personalization:{page:!0,views:!0}})},onResponse:function(e){(e.getPayloadByType("personalization:page")||[]).forEach(function(e){var r=e.rules,o=void 0===r?[]:r;v(o)&&Oe(o,n,t)})}}}};Ee.namespace="Personalization";var Ce,Se=function(e){return function(){var n=e,t=n.location;try{for(var r=n.parent;r&&r.location&&t&&String(r.location)!==String(t)&&n.location&&String(r.location)!==String(n.location)&&r.location.host===t.host;)r=(n=r).parent}catch(e){}return n}}(window),je=function(e,n){var t;return function(r){t=t||n(),r.mergeWeb({webPageDetails:{URL:e.location.href||e.location},webReferrer:{URL:t.document.referrer}})}}(window,Se),xe=function(e){return function(n){var t=e.screen,r=t.width,o={screenHeight:t.height,screenWidth:r},i=function(e){var n=e.screen.orientation;if(null==n||null==n.type)return null;var t=n.type.split("-");return 0===t.length?null:"portrait"!==t[0]&&"landscape"!==t[0]?null:t[0]}(e)||function(e){return e.matchMedia("(orientation: portrait)").matches?"portrait":e.matchMedia("(orientation: landscape)").matches?"landscape":null}(e);return i&&(o.screenOrientation=i),n.mergeDevice(o)}}(window),Ie=function(e){return function(n){var t=e.innerWidth,r=e.innerHeight,o=e.navigator,i={type:"browser",browserDetails:{viewportWidth:t,viewportHeight:r}};o&&o.connection&&o.connection.effectiveType&&(i.connectionType=o.connection.effectiveType),n.mergeEnvironment(i)}}(window),Re=(window,Ce=function(){return new Date},function(e){var n=Ce(),t={localTime:n.toISOString(),localTimezoneOffset:n.getTimezoneOffset()};e.mergePlaceContext(t)}),Te=function(e){return function(e,n,t){var r;return{namespace:"Context",lifecycle:{onComponentsRegistered:function(){var o=[];Array.isArray(e.context)?o=e.context:n.warn("Invalid configured context. Please specify an array of strings."),r=o.filter(function(e){return!!t[e]||(n.warn("Configured context "+e+" is not available."),!1)}).map(function(e){return t[e]})},onBeforeEvent:function(e){r.forEach(function(n){return n(e)})}}}}(e.config,e.logger,{web:je,device:xe,environment:Ie,placeContext:Re})};Te.namespace="Context",Te.configValidators={context:{defaultValue:["web","device","environment","placeContext"]}};var ke=function(){return{commands:{getLibraryInfo:function(){return{version:"0.0.1-alpha.3"}}}}};ke.namespace="LibraryInfo";var Pe,De=[le,ge,ve,Ee,Te,ke],Ae=window.__alloyNS,Be=(Pe=window,function(e){var n=V+(e||"");return{session:Y(Pe,"sessionStorage",n),persistent:Y(Pe,"localStorage",n)}});Ae&&Ae.forEach(function(e){var n=function(e,n){var t=n("instance."+e+"."),r="true"===t.persistent.getItem("log");return{get logEnabled(){return r},set logEnabled(e){t.persistent.setItem("log",e),r=e}}}(e,Be),t=function e(n,t,r){var o=function(e){if(t.logEnabled){for(var o,i=arguments.length,a=new Array(i>1?i-1:0),c=1;c<i;c++)a[c-1]=arguments[c];(o=n.console)[e].apply(o,[r].concat(a))}};return{log:o.bind(null,"log"),info:o.bind(null,"info"),warn:o.bind(null,"warn"),error:o.bind(null,"error"),spawn:function(o){return e(n,t,r+" "+o)}}}(window,n,"["+e+"]"),r=ae(De,t,Be,se),o=G(e,r,n,t,window),i=window[e].q;i.push=o,i.forEach(o)})});
